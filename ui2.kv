#:import Factory kivy.factory.Factory
<MainWindow>:
    screen_manager: screen_manager
    side_bar: side_bar
    canvas.before:
        Rectangle:
            size: self.size
            pos:self.pos
    SideBar:
        id: side_bar
        size_hint:0.2,1
        pos_hint:{"x":0}
    ScreenManagement:
        id: screen_manager
        size_hint:0.8,1
        pos_hint:{"x":0.2}

<SideBar>:
    orientation: 'vertical'
    canvas.before:
        Color:
            rgb: .172,.184,.196
        Rectangle:
            size: self.size
            pos:self.pos
    device_rv:device_rv
    home_button:home_button
    new_device_button:new_device_button
    side_bar_title:side_bar_title
    Label:
        id: side_bar_title
        text:"NeuroStim"
        color:1,1,1,1
        font_size:45
        size_hint:1,0.1
        pos_hint:{"top":1}
    HomeButton:
        id: home_button
    NewDeviceButton:
        id: new_device_button
    DeviceRV:
        id: device_rv

<ScreenManagement>
    home_screen: home_screen
    device_screen: device_screen
    HomeScreen:
        id: home_screen
    DeviceScreen:
        id: device_screen

<HomeScreen>:
    name: "home"
    windows: windows
    canvas.before:
        Color:
            rgb:1,1,1
        Rectangle:
            size: self.size
            pos:self.pos
    HomeScreenWindows:
        id: windows
        #change window size/pos here
        size_hint:0.4,0.5
        pos_hint: {"center_x":0.76,"center_y":0.71}
        Label:
            canvas.before:
                Color:
                    rgb:0.176,0.188,0.2
                RoundedRectangle:
                    size: self.size
                    pos:self.pos
                    radius:10,10,0,0
            text:"Beginner Tutorial" #change the name of window
            font_size:40
            color:1,1,1,1
            pos_hint:{"top":1,"x":0}
            size_hint:1,0.1

<DeviceScreen>:
    name: "device"
    canvas.before:
        Color:
            rgb:1,1,1
        Rectangle:
            size: self.size
            pos:self.pos
    device_tabs: device_tabs
    DeviceTabs:
        id: device_tabs

###windows for homescreen###
##################################################
<HomeScreenWindows@FloatLayout+DragBehavior>
    drag_rectangle: self.x, self.y, self.width, self.height
    drag_timeout: 10000000
    drag_distance: 0
    canvas.before:
        Color:
            rgb:0.9,0.9,0.9
        RoundedRectangle:
            size: self.size
            pos:self.pos

##################################################


###widgets for sidebar###
##################################################
<DeviceRV>:
    size_hint: 1, 0.7
    pos_hint: {"x":0, "top":.85}
    background_color: 0.0,0.50,0,1
    viewclass: 'ConnectedDeviceSelectableLabel'
    SelectableRecycleBoxLayout:
        default_size_hint: 1, None
        size_hint_y: None
        height: self.minimum_height
        orientation: 'vertical'
        multiselect: False
        touch_multiselect: False
        spacing: 2

<AddDeviceSelectableLabel>:
    # Draw a background to indicate selection
    color:0,0,0,1
    canvas.before:
        Color:
            rgba: (.0, 0.9, .1, .3) if self.selected else (1, 1, 1, 1)
        RoundedRectangle:
            pos: self.pos
            size: self.size

<ConnectedDeviceSelectableLabel>:
    # Draw a background to indicate selection
    _label:_label
    canvas.before:
        Color:
            rgba: (.0, 0.9, .1, .3) if self.selected else (0.1, 0, 0.1, 1)
        Rectangle:
            pos: self.pos
            size: self.size
    Label:
        id: _label
        size_hint: 1, .2
        color: 1, 1, 0, 1
        font_size: 16
        valign: 'top'
        halign: 'center'
        pos_hint: {"x":0, "top":.95}
    Image:
        size_hint: .125, .125
        pos_hint: {"x":0.05, "top":0.6}
        source: './Icon2/working.png'
    Image:
        size_hint: .125, .125
        pos_hint: {"x":0.2, "top":0.6}
        source: './Icon2/working.png'
    Image:
        size_hint: .125, .125
        pos_hint: {"x":0.35, "top":0.6}
        source: './Icon2/not_working.png'
    Image:
        size_hint: .125, .125
        pos_hint: {"x":0.825, "top":0.6}
        source: './Icon2/malfunction.png'
    Image:
        size_hint: .2, .2
        pos_hint: {"x":0.75, "top":0.25}
        source: './Icon2/delete.png'
    Image:
        size_hint: .2, .2
        pos_hint: {"x":0.55, "top":0.25}
        source: './Icon2/Rename.png'
    Image:
        size_hint: .2, .2
        pos_hint: {"x":0.05, "top":0.25}
        source: './Icon2/battery.png'
    Label:
        size_hint: .2, .2
        pos_hint: {"x":0.275, "top":0.25}
        text: "89%"


<HomeButton@Button>
    text: "Home"
    font_size: 30
    color: 1,1,1,1
    size_hint: 1, 0.05
    pos_hint: {"top":0.9}
    background_color: .4,.4,.4,1
    on_press:
        app.root.screen_manager.transition.direction = 'down'
        app.root.screen_manager.current = 'home'

<AddDevicePopup>:
    title: "Bluetooth Discovery"
    title_size:35
    title_align:'center'
    separator_height:0
    ble_rv: ble_rv
    size_hint: .45,.73
    pos_hint: {"center_x":0.5,"center_y":0.5}
    auto_dismiss : True
    on_open: root.BluetoothDiscoverLoop()
    FloatLayout:
        canvas.before:
            Color:
                rgb:0.878,0.898,0.933
            Rectangle:
                size:self.size
                pos:self.pos
        RecycleView:
            id: ble_rv
            size_hint: 1, 0.895
            pos_hint: {"x":0, "top":1}
            viewclass: 'AddDeviceSelectableLabel'
            SelectableRecycleBoxLayout:
                default_size: None, dp(56)
                default_size_hint: 1, None
                size_hint_y: None
                height: self.minimum_height
                orientation: 'vertical'
                multiselect: False
                touch_multiselect: False
                spacing:dp(2)
        Label:
            size_hint: 1, 0.1
            pos_hint: {"x":0, "y":0}
            canvas.before:
                Color:
                    rgb:0.953,0.9608,0.9765
                Rectangle:
                    size:self.size
                    pos:self.pos
        Button:
            text: "Connect"
            size_hint: 0.3, 0.08
            pos_hint: {"x":0.65, "top":.09}
            background_color: 0.420,0.864,1.773,1
            on_press: root.Close()
        Button:
            text: "Refresh"
            size_hint: 0.3, 0.08
            pos_hint: {"x":0.05, "top":.09}
            background_color: 1,1,1,1
            on_press: root.BluetoothDiscoverLoop()

<NewDeviceButton@Button>
    font_size: 30
    color: 1,1,1,1
    size_hint: 1, 0.06
    text: "+ New Device"
    pos_hint: {"bottom":1}
    background_color: 0.420,0.864,1.773,1
    on_release: Factory.AddDevicePopup().open()
##################################################0.3451


###widgets for device screen###
##################################################
<CathodicAnodicToggle@BoxLayout>:
    pos_hint: {"x":0.075, "top":.6}
    size_hint: .85,.06
    cathodic: cathodic
    anodic: anodic
    ToggleButton:
        id: cathodic
        text: "Cathodic First"
        font_size: 14
        group: "cathodic_anodic"
        state: "down"
    ToggleButton:
        id: anodic
        text: "Anodic First"
        group: "cathodic_anodic"
        font_size: 14

<TerminationTabs>:
    tab_width: (self.parent.width*.85)/3
    pos_hint: {"x":0.075, "top":.45}
    size_hint: .85,.25
    do_default_tab: False
    termination_tabs_time_input:termination_tabs_time_input
    termination_tabs_duty_cycle_input:termination_tabs_duty_cycle_input
    TabbedPanelItem:
        text: "Time"
        font_size: 14
        group: "termination"
        FloatLayout:
            Label:
                pos_hint: {"x":0, "top":.99}
                size_hint: 1,.3
                text_size: self.size
                halign: 'left'
                valign: 'middle'
                text: " Number of Minutes"
            TextInput:
                id: termination_tabs_time_input
                pos_hint: {"x":0, "top":.69}
                size_hint: 1,.69
                text: "1"
                multiline:False
                input_type: 'number'
                input_filter: 'float'
                multiline: False
    TabbedPanelItem:
        text: "Duty Cycle"
        group: "termination"
        font_size: 14
        FloatLayout:
            Label:
                pos_hint: {"x":0, "top":.99}
                size_hint: 1,.3
                text_size: self.size
                halign: 'left'
                valign: 'middle'
                text: " Number of Cycles"
            TextInput:
                id: termination_tabs_duty_cycle_input
                pos_hint: {"x":0, "top":.69}
                size_hint: 1,.69
                text: "1"
                input_type: 'number'
                input_filter: 'float'
                multiline: False
    TabbedPanelItem:
        text: "Non-Stop"
        group: "termination"
        font_size: 14

<DeviceSettings@BoxLayout>:
    stimulation_tabs: stimulation_tabs
    size_hint: 1,1
    pos_hint: {"x":0, "top":1}
    orientation: 'vertical'
    ChannelStimulationTabs:
        id: stimulation_tabs


<PhaseTimeFrequencyTabs>:
    tab_width: (self.parent.width*.995)/2
    size_hint: .995,1
    pos_hint: {"x":0, "top":1}
    do_default_tab: False
    color: .2,.2,.1,1
    background_color: 0.1,0.2,0.3,1

    channel_1_inter_phase_delay_input: channel_1_inter_phase_delay_input
    channel_1_inter_stim_delay_input: channel_1_inter_stim_delay_input
    channel_1_phase_1_time_input: channel_1_phase_1_time_input
    channel_1_phase_2_time_input: channel_1_phase_2_time_input
    channel_1_frequency_input: channel_1_frequency_input

    TabbedPanelItem:
        text: "Phase Time"
        FloatLayout:
            Label:
                size_hint: .4,.25
                pos_hint: {"x":0.05, "top":1}
                text: "Inter-Phase Delay(ms)"
                text_size: self.size
                halign: 'left'
                valign: 'middle'
            TextInput:
                id: channel_1_inter_phase_delay_input
                size_hint: .4,.25
                pos_hint: {"x":0.05, "top":0.75}
                text: "1"
                input_type: 'number'
                input_filter: 'float'
                multiline: False
            Label:
                size_hint: .4,.25
                pos_hint: {"x":0.05, "top":0.5}
                text: "Inter-Stim Delay(ms)"
                text_size: self.size
                halign: 'left'
                valign: 'middle'
            TextInput:
                id: channel_1_inter_stim_delay_input
                size_hint: .4,.25
                pos_hint: {"x":0.05, "top":0.25}
                text: "1"
                input_type: 'number'
                input_filter: 'float'
                multiline: False
            Label:
                size_hint: .4,.25
                pos_hint: {"x":0.55, "top":1}
                text: "Phase 1 Time(ms)"
                text_size: self.size
                halign: 'left'
                valign: 'middle'
            TextInput:
                id: channel_1_phase_1_time_input
                size_hint: .4,.25
                pos_hint: {"x":0.55, "top":0.75}
                text: "1"
                input_type: 'number'
                input_filter: 'float'
                multiline: False
            Label:
                size_hint: .4,.25
                pos_hint: {"x":0.55, "top":0.5}
                text: "Phase 2 Time(ms)"
                text_size: self.size
                halign: 'left'
                valign: 'middle'
            TextInput:
                id: channel_1_phase_2_time_input
                size_hint: .4,.25
                pos_hint: {"x":0.55, "top":0.25}
                text: "1"
                input_type: 'number'
                input_filter: 'float'
                multiline: False
    TabbedPanelItem:
        text: "Frequency"
        FloatLayout:
            Label:
                size_hint: .4,.25
                pos_hint: {"x":0.05, "top":1}
                text: "Frequency (pps)"
                text_size: self.size
                halign: 'left'
                valign: 'middle'
            TextInput:
                id: channel_1_frequency_input
                size_hint: .4,.25
                pos_hint: {"x":0.05, "top":0.75}
                text: "1"
                input_type: 'number'
                input_filter: 'float'
                multiline: False

<ChannelStimulationTabs>:
    tab_width: (self.parent.width)/2
    size_hint: .995,1
    pos_hint: {"x":0, "top":1}
    do_default_tab: False
    color: .2,.2,.1,1
    background_color: 0.1,0.2,0.3,1

    channel_1_stop_button:channel_1_stop_button
    channel_1_save_button:channel_1_save_button
    channel_1_start_button:channel_1_start_button
    channel_1_output_current_input:channel_1_output_current_input
    channel_1_termination_tabs:channel_1_termination_tabs
    channel_1_cathodic_anodic_toggle:channel_1_cathodic_anodic_toggle
    channel_1_ramp_up_toggle:channel_1_ramp_up_toggle
    channel_1_electrode_toggle:channel_1_electrode_toggle
    # channel_1_electrode_button:channel_1_electrode_button

    channel_2_stop_button:channel_2_stop_button
    channel_2_save_button:channel_2_save_button
    channel_2_start_button:channel_2_start_button
    channel_2_output_current_input:channel_2_output_current_input
    channel_2_termination_tabs:channel_2_termination_tabs
    channel_2_cathodic_anodic_toggle:channel_2_cathodic_anodic_toggle
    channel_2_ramp_up_toggle:channel_2_ramp_up_toggle
    channel_2_electrode_toggle:channel_2_electrode_toggle
    # channel_2_electrode_button:channel_2_electrode_button

    channel_1_stimulation_graph_display: channel_1_stimulation_graph_display
    channel_2_stimulation_graph_display: channel_2_stimulation_graph_display

    channel_1_phase_time_frequency_tab:channel_1_phase_time_frequency_tab
    channel_1_burst_uniform_stimulation_tab:channel_1_burst_uniform_stimulation_tab
    channel_2_phase_time_frequency_tab:channel_2_phase_time_frequency_tab
    channel_2_burst_uniform_stimulation_tab:channel_2_burst_uniform_stimulation_tab

    TabbedPanelItem:
        text: "Channel 1"
        BoxLayout:
            orientation: 'vertical'
            BoxLayout:
                orientation: 'horizontal'
                BoxLayout:
                    orientation: 'vertical'
                    PhaseTimeFrequencyTabs:
                        id: channel_1_phase_time_frequency_tab
                    BurstUniformStimulationTabs:
                        id: channel_1_burst_uniform_stimulation_tab
                FloatLayout:
                    Button:
                        id: channel_1_stop_button
                        size_hint: .25,.06
                        pos_hint: {"x":0.075, "top":.99}
                        text: "Stop"
                    Button:
                        id:channel_1_save_button
                        size_hint: .25,.06
                        pos_hint: {"x":0.375, "top":.99}
                        text: "Save"
                    Button:
                        id:channel_1_start_button
                        size_hint: .25,.06
                        pos_hint: {"x":0.675, "top":.99}
                        text: "Start"
                    Label:
                        size_hint: .4,.05
                        pos_hint: {"x":0.075, "top":.9}
                        text: "Output Current (A)"
                    TextInput:
                        id:channel_1_output_current_input
                        size_hint: .4,.08
                        pos_hint: {"x":0.075, "top":.85}
                        text: "1"
                        input_type: 'number'
                        input_filter: 'float'
                        multiline: False
                    Label:
                        size_hint: .4,.05
                        pos_hint: {"x":0.075, "top":.5}
                        text: "End Stimulation By:"
                    TerminationTabs:
                        id: channel_1_termination_tabs
                    CathodicAnodicToggle:
                        id: channel_1_cathodic_anodic_toggle
                    ToggleButton:
                        id: channel_1_ramp_up_toggle
                        size_hint: .4,.06
                        pos_hint: {"x":0.075, "top":0.7}
                        text: "Ramp Up"
                        group: "ramp_up"
                    ToggleButton:
                        id: channel_1_electrode_toggle
                        size_hint: .4,.06
                        pos_hint: {"x":0.525, "top":0.7}
                        text: "Short Electrode"
                        group: "electrode"
                    #Button:
                    #    id: channel_1_electrode_button
                    #    size_hint: .4,.1
                    #    pos_hint: {"x":0.525, "top":0.15}
                    #    text: "Generate Graph"
                    #    group: "electrode"
                    #    on_press: get_squarewave_plot()
            BoxLayout:
                canvas:
                    Color:
                        rgba: 1,1,1,1
                    Rectangle:
                        size: self.size
                        pos: self.pos
                size_hint: 1,.5
                pos_hint: {"x":0, "top":1}
                id: channel_1_stimulation_graph_display
    TabbedPanelItem:
        text: "Channel 2"
        BoxLayout:
            orientation: 'vertical'
            BoxLayout:
                orientation: 'horizontal'
                BoxLayout:
                    orientation: 'vertical'
                    PhaseTimeFrequencyTabs:
                        id: channel_2_phase_time_frequency_tab
                    BurstUniformStimulationTabs:
                        id: channel_2_burst_uniform_stimulation_tab
                FloatLayout:
                    Button:
                        id: channel_2_stop_button
                        size_hint: .25,.06
                        pos_hint: {"x":0.075, "top":.99}
                        text: "Stop"
                    Button:
                        id: channel_2_save_button
                        size_hint: .25,.06
                        pos_hint: {"x":0.375, "top":.99}
                        text: "Save"
                    Button:
                        id: channel_2_start_button
                        size_hint: .25,.06
                        pos_hint: {"x":0.675, "top":.99}
                        text: "Start"
                    Label:
                        size_hint: .4,.05
                        pos_hint: {"x":0.075, "top":.9}
                        text: "Output Current (A)"
                    TextInput:
                        id: channel_2_output_current_input
                        size_hint: .4,.08
                        pos_hint: {"x":0.075, "top":.85}
                        text: "1"
                        input_type: 'number'
                        input_filter: 'float'
                        multiline: False
                    Label:
                        size_hint: .4,.05
                        pos_hint: {"x":0.075, "top":.5}
                        text: "End Stimulation By:"
                    TerminationTabs:
                        id: channel_2_termination_tabs
                    CathodicAnodicToggle:
                        id: channel_2_cathodic_anodic_toggle
                    ToggleButton:
                        id: channel_2_ramp_up_toggle
                        size_hint: .4,.06
                        pos_hint: {"x":0.075, "top":0.7}
                        text: "Ramp Up"
                        group: "ramp_up"
                    ToggleButton:
                        id: channel_2_electrode_toggle
                        size_hint: .4,.06
                        pos_hint: {"x":0.525, "top":0.7}
                        text: "Short Electrode"
                        group: "electrode"
                    # Button:
                    #     id: channel_2_electrode_button
                    #     size_hint: .4,.1
                    #     pos_hint: {"x":0.525, "top":0.15}
                    #     text: "Generate Graph"
            BoxLayout:
                canvas:
                    Color:
                        rgba: 1,1,1,1
                    Rectangle:
                        size: self.size
                        pos: self.pos
                size_hint: 1,.5
                pos_hint: {"x":0, "top":1}
                id: channel_2_stimulation_graph_display


<BurstUniformStimulationTabs>:
    tab_width: (self.parent.width*.995)/2
    size_hint: .995,1
    pos_hint: {"x":0, "top":1}
    do_default_tab: False
    color: .2,.2,.1,1
    background_color: 0.1,0.2,0.3,1
    inter_burst_delay:inter_burst_delay
    burst_duration:burst_duration
    TabbedPanelItem:
        text: "Burst Stimulation"
        FloatLayout:
            Label:
                size_hint: .4,.25
                pos_hint: {"x":0.05, "top":1}
                text: "Burst Duration"
                text_size: self.size
                halign: 'left'
                valign: 'middle'
            TextInput:
                id: burst_duration
                size_hint: .4,.25
                pos_hint: {"x":0.05, "top":0.75}
                text: "1"
                input_type: 'number'
                input_filter: 'float'
                multiline: False
            Label:
                size_hint: .4,.25
                pos_hint: {"x":0.55, "top":1}
                text: "Inter-Burst Delay"
                text_size: self.size
                halign: 'left'
                valign: 'middle'
            TextInput:
                id: inter_burst_delay
                size_hint: .4,.25
                pos_hint: {"x":0.55, "top":0.75}
                text: "1"
                input_type: 'number'
                input_filter: 'float'
                multiline: False
    TabbedPanelItem:
        text: "Uniform Stimulation"

<DeviceTabs@TabbedPanel+DT_TPS>:
    stimulation_log_tab: stimulation_log_tab
    advanced_settings: advanced_settings
    device_settings: device_settings
    size_hint: 1,1
    pos_hint: {"top":1}
    do_default_tab: False
    tab_width: (self.parent.width)/4
    tab_pos : 'top_mid'
    TabbedPanelItem:
        text: "Stimulation Setting"
        DeviceSettings:
            id: device_settings
    TabbedPanelItem:
        text: "Stimulation Log"
        StimulationLogTab:
            id: stimulation_log_tab
    TabbedPanelItem:
        text: "EEG recording"
    TabbedPanelItem:
        text: "Advanced Settings"
        DeviceAdvancedSettings:
            id: advanced_settings

<DT_TPS@TabbedPanelStrip>
    canvas:
        Color:
            rgba: 0, 1, 0, 1
        Rectangle:
            size: self.size
            pos: self.pos


<StimulationLogTab@FloatLayout>:
    size_hint: 1,1
    pos_hint: {"x":0, "top":1}

    top_graph:top_graph
    bottom_graph:bottom_graph
    sample_info:sample_info
    log_stop_button:log_stop_button
    log_recording_button:log_recording_button
    save_log_button:save_log_button

    Label:
        text: "Sample info (1k)"
        size_hint: .16, .08
        pos_hint: {"x":0.05,"top":0.95}
    TextInput:
        id: sample_info
        text: "1"
        size_hint: .16, .06
        pos_hint: {"x":0.25,"top":0.94}
        multiline:False
        input_type: 'number'
        input_filter: 'float'
        multiline: False
    Button:
        id: log_stop_button
        size_hint: .16,0.06
        pos_hint: {"x":0.59,"top":0.94}
        text: "Stop"
    Button:
        id: log_recording_button
        size_hint: .16,0.06
        pos_hint: {"x":0.79,"top":0.94}
        text: "Recording..."
    Button:
        id: save_log_button
        size_hint: .16,0.06
        pos_hint: {"x":0.79,"top":0.85}
        text: "Save Log"
    FloatLayout:
        id: top_graph
        canvas.before:
            Color:
                rgba: 1, 1, 1, 1
            Rectangle:
                pos: self.pos
                size: self.size
        size_hint: .9,0.33
        pos_hint: {"x":0.05,"top":0.75}
    FloatLayout:
        id: bottom_graph
        canvas.before:
            Color:
                rgba: 1, 1, 1, 1
            Rectangle:
                pos: self.pos
                size: self.size
        size_hint: .9,0.33
        pos_hint: {"x":0.05,"top":0.375}

<DeviceAdvancedSettings@FloatLayout>:
    size_hint: 1,1
    pos_hint: {"x":0, "top":1}
    auto_shutdown_when_stim_is_finished:auto_shutdown_when_stim_is_finished
    auto_shutdown_when_surge_is_detected:auto_shutdown_when_surge_is_detected
    firmware_info_button:firmware_info_button
    hardware_info_button:hardware_info_button
    bootloader_access_button:bootloader_access_button
    ramp_up_button:ramp_up_button
    ramp_up_input:ramp_up_input
    short_button:short_button
    continuity_check_button:continuity_check_button
    triggered_mode_button:triggered_mode_button
    triggered_mode_toggle:triggered_mode_toggle
    ramp_dac_button:ramp_dac_button
    null_command_button:null_command_button
    debug_mode_button:debug_mode_button
    test_trigger_button:test_trigger_button
    all_off_button:all_off_button
    phase_2_button:phase_2_button
    phase_1_button:phase_1_button
    Label:
        text: "General"
        font_size: 15
        size_hint: 0.9, .08
        pos_hint: {"x":0.05,"top":1}
        multiline: False
        text_size:self.size
        halign:'left'
        valign:'middle'
    Label:
        text: "Stimulation Setting"
        font_size: 15
        size_hint: 0.9, .08
        pos_hint: {"x":0.05,"top":0.675}
        multiline: False
        text_size:self.size
        halign:'left'
        valign:'middle'
    StrokeButton:
        id: auto_shutdown_when_stim_is_finished
        size_hint: 0.425, .08
        pos_hint: {"x":0.05,"top":0.9}
        font_size: 13
        text: "Auto shutdown when stimulation is finished"
        group: "finished_shutdown"
    StrokeButton:
        id: auto_shutdown_when_surge_is_detected
        size_hint: 0.425, .08
        pos_hint: {"x":0.525,"top":0.9}
        font_size: 13
        text: "Auto shutdown when surge is detected"
        group: "shutdown_surge"
    SmoothButton:
        id: firmware_info_button
        size_hint: 0.2, .08
        pos_hint: {"x":0.05,"top":0.7825}
        font_size: 13
        text: "Firmware Info"
    SmoothButton:
        id: hardware_info_button
        size_hint: 0.2, .08
        pos_hint: {"x":0.3,"top":0.7825}
        font_size: 13
        text: "Hardware Info"
    SmoothButton:
        id: bootloader_access_button
        size_hint: 0.2, .08
        pos_hint: {"x":0.55,"top":0.7825}
        font_size: 13
        text: "Bootloader Access"
    StrokeButton:
        id: ramp_up_button
        size_hint: 0.16, .08
        pos_hint: {"x":0.05,"top":0.6}
        font_size: 13
        text: "Ramp Up"
        group: "ramp_up"
    RampUpInput:
        id: ramp_up_input
    StrokeButton:
        id: short_button
        size_hint: 0.16, .08
        pos_hint: {"x":0.25,"top":0.6}
        font_size: 13
        text: "Short"
        group: "short"
    SmoothButton:
        id: continuity_check_button
        size_hint: 0.2, .08
        pos_hint: {"x":0.45,"top":0.6}
        font_size: 13
        text: "Continuity Check"
    StrokeButton:
        id: triggered_mode_button
        size_hint: 0.16, .08
        pos_hint: {"x":0.79,"top":0.6}
        font_size: 13
        text: "Triggered Mode"
        group:"triggered_mode"
    TriggeredModeToggle:
        id: triggered_mode_toggle
    Label:
        text: "Diagnostic Tools"
        font_size: 15
        size_hint: 0.9, .08
        pos_hint: {"x":0.05,"top":0.375}
        multiline: False
        text_size:self.size
        halign:'left'
        valign:'middle'
    SmoothButton:
        id: ramp_dac_button
        size_hint: 0.185, .08
        pos_hint: {"x":0.05,"top":0.3}
        font_size: 13
        text: "Ramp DAC"
    SmoothButton:
        id: phase_1_button
        size_hint: 0.185, .08
        pos_hint: {"x":0.285,"top":0.3}
        font_size: 13
        text: "Phase 1"
    SmoothButton:
        id: phase_2_button
        size_hint: 0.185, .08
        pos_hint: {"x":0.53,"top":0.3}
        font_size: 13
        text: "Phase 2"
    SmoothButton:
        id: all_off_button
        size_hint: 0.185, .08
        pos_hint: {"x":0.765,"top":0.3}
        font_size: 13
        text: "All Off"
    SmoothButton:
        id: null_command_button
        size_hint: 0.185, .08
        pos_hint: {"x":0.05,"top":0.2}
        font_size: 13
        text: "Null Command"
    SmoothButton:
        id: test_trigger_button
        size_hint: 0.185, .08
        pos_hint: {"x":0.285,"top":0.2}
        font_size: 13
        text: "Test Trigger"
    SmoothButton:
        id: debug_mode_button
        size_hint: 0.185, .08
        pos_hint: {"x":0.53,"top":0.2}
        font_size: 13
        text: "Debug Mode"

<RampUpInput@FloatLayout>:
    size_hint: 0.21, .1
    pos_hint: {"x":0.05,"top":0.5}
    background_color: (0, 0, 0, 0)
    background_normal: ''
    back_color: 0.16, 0.45, 0.75, 1
    border_radius: 5
    color: 0,0,0,1
    ramp_up_text_input: ramp_up_text_input
    canvas.before:
        Color:
            rgba: self.back_color
        Line:
            rounded_rectangle: (self.pos[0], self.pos[1], self.size[0], self.size[1], self.border_radius)
            width: 1.2
    Label:
        text: "Ramp Up (ms)"
        size_hint: .9, 0.4
        font_size: 12
        pos_hint: {"x":0.05,"top":.95}
        multiline: False
    TextInput:
        id: ramp_up_text_input
        text: "1"
        size_hint: 0.9, 0.45
        font_size: 12
        multiline:False
        pos_hint: {"x":0.05,"top":.55}
        input_type: 'number'
        input_filter: 'float'
        multiline: False

<TriggeredModeToggle@FloatLayout>:
    size_hint: 0.65, .1
    pos_hint: {"x":0.3,"top":0.5}
    background_color: (0, 0, 0, 0)
    background_normal: ''
    back_color: 0.16, 0.45, 0.75, 1
    border_radius: 5
    color: 0,0,0,1
    none_button:none_button
    phase_1_button:phase_1_button
    phase_2_button:phase_2_button
    phase_1_and_2_button:phase_1_and_2_button
    inter_stim_time_button:inter_stim_time_button
    canvas.before:
        Color:
            rgba: self.back_color
        Line:
            rounded_rectangle: (self.pos[0], self.pos[1], self.size[0], self.size[1], self.border_radius)
            width: 1.2
    StrokeButton:
        id: none_button
        size_hint: 0.15, .8
        pos_hint: {"x":0.025,"top":0.9}
        font_size: 11
        text: "None"
        state: "down"
        group:"trigger_mode"
        text_size: self.size
        halign: 'center'
        valign: 'middle'
    StrokeButton:
        id: phase_1_button
        size_hint: 0.15, .8
        pos_hint: {"x":0.225,"top":0.9}
        font_size: 11
        text: "Phase 1"
        group:"trigger_mode"
        text_size: self.size
        halign: 'center'
        valign: 'middle'
    StrokeButton:
        id: phase_2_button
        size_hint: 0.15, .8
        pos_hint: {"x":0.425,"top":0.9}
        font_size: 11
        text: "Phase 2"
        group:"trigger_mode"
        text_size: self.size
        halign: 'center'
        valign: 'middle'
    StrokeButton:
        id: phase_1_and_2_button
        size_hint: 0.15, .8
        pos_hint: {"x":0.625,"top":0.9}
        font_size: 11
        text: "Phase\n1 & 2"
        group:"trigger_mode"
        text_size: self.size
        halign: 'center'
        valign: 'middle'
    StrokeButton:
        id: inter_stim_time_button
        size_hint: 0.15, .8
        pos_hint: {"x":0.825,"top":0.9}
        font_size: 11
        text: "Inter-Stim\nTime"
        group:"trigger_mode"
        text_size: self.size
        halign: 'center'
        valign: 'middle'

<SmoothButton@Button>:
    background_color: (0.0, 0.96, 1, 1) if self.state=='down' else (0, 0, 0, 0)
    background_normal: ''
    back_color: (0.16, 0.45, 0.75, 1)
    border_radius: [5]
    canvas.before:
        Color:
            rgba: self.back_color
        RoundedRectangle:
            size: self.size
            pos: self.pos
            radius: self.border_radius

<SmoothToggleButton@ToggleButton>:
    background_color: (0.0, 0.96, 1, 1) if self.state=='down' else (0, 0, 0, 0)
    background_normal: ''
    back_color: 0.16, 0.45, 0.75, 1
    border_radius: [5]
    canvas.before:
        Color:
            rgba: self.back_color
        RoundedRectangle:
            size: self.size
            pos: self.pos
            radius: self.border_radius

<StrokeButton@ToggleButton>:
    background_color: (0.16, 0.45, 0.75, 1) if self.state=='down' else (0, 0, 0, 0)
    background_normal: ''
    back_color: 0.16, 0.45, 0.75, 1
    border_radius: 5
    color: 0,0,0,1
    bold: True
    canvas.before:
        Color:
            rgba: self.back_color
        Line:
            rounded_rectangle: (self.pos[0], self.pos[1], self.size[0], self.size[1], self.border_radius)
            width: 1.2

##################################################