#:import Factory kivy.factory.Factory

ScreenManagement:
    home:home
    device:device
    HomeScreen:
        id:home
    DeviceScreen:
        id:device

<AddDeviceSelectableLabel>:
    # Draw a background to indicate selection
    canvas.before:
        Color:
            rgba: (.0, 0.9, .1, .3) if self.selected else (0, 0, 0, 1)
        Rectangle:
            pos: self.pos
            size: self.size

<ConnectedDeviceSelectableLabel>:
    # Draw a background to indicate selection
    canvas.before:
        Color:
            rgba: (.0, 0.9, .1, .3) if self.selected else (0, 0, 0, 1)
        Rectangle:
            pos: self.pos
            size: self.size
    Image:
        size_hint: .2, .2
        pos_hint: {"x":0.75, "top":0.25}
        source: './Icon/delete.png'
    Image:
        size_hint: .2, .2
        pos_hint: {"x":0.55, "top":0.25}
        source: './Icon/Rename.png'
    Image:
        size_hint: .2, .2
        pos_hint: {"x":0.05, "top":0.25}
        source: './Icon/battery.png'

<HomeButton@Button>
    font_size: 20
    color: .1,.5,.6,1
    size_hint: 0.2, 0.15
    text: "HOME"
    pos_hint: {"x":0, "top":1}
    background_color: 0.1,0.2,0.3,1
    on_press: app.root.current = 'home'

<AddDevicePopup@Popup>:
    auto_dismiss: False
    title: "Add Device"
    ble_rv: ble_rv
    size_hint: .8,.8
    on_open: root.BluetoothDiscoverLoop()
    FloatLayout:
        RecycleView:
            id: ble_rv
            size_hint: 1, 0.9
            pos_hint: {"x":0, "top":1}
            background_color: 0.0,0.50,0,1
            viewclass: 'AddDeviceSelectableLabel'
            SelectableRecycleBoxLayout:
                default_size: None, dp(56)
                default_size_hint: 1, None
                size_hint_y: None
                height: self.minimum_height
                orientation: 'vertical'
                multiselect: True
                touch_multiselect: True
        Button:
            text: "Add Devices"
            size_hint: 1, 0.1
            pos_hint: {"x":0, "top":.1}
            background_color: 0.0,0.50,0,1
            on_press: root.Close()

<NewDeviceButton@Button>
    font_size: 20
    color: .1,.5,.6,1
    size_hint: 0.2, 0.15
    text: "New Device"
    pos_hint: {"x":0, "bottom":1}
    background_color: 0.2,0.5,0.3,1
    on_release: Factory.AddDevicePopup().open()

<BeginnerTutorial@Button>:
    font_size: 20
    color: .1,.5,.6,1
    text: "Beginner Tutorial"
    background_color: 0.2,0.5,0.3,1
    size_hint: 0.3, 0.35
    pos_hint: {"x":0.65, "top":0.95}

<GetHelp@Button>:
    font_size: 20
    color: .1,.5,.6,1
    text: "Get Help"
    background_color: 0.2,0.5,0.3,1
    size_hint: 0.12, 0.08
    font_size: 15
    pos_hint: {"x":0.65, "top":0.53}

<ReportBug@Button>:
    font_size: 20
    color: .1,.5,.6,1
    text: "Report Bug"
    font_size: 15
    background_color: 0.2,0.5,0.3,1
    size_hint: 0.12, 0.08
    pos_hint: {"x":0.83, "top":0.53}

<LatestUpdate@Button>:
    font_size: 20
    color: .1,.5,.6,1
    text: "Latest Update"
    background_color: 0.2,0.5,0.3,1
    size_hint: 0.25, 0.5
    pos_hint: {"x":0.3, "top":0.95}

<SettingsHome@Button>:
    font_size: 20
    color: .1,.5,.6,1
    text: "Settings"
    background_color: 0.2,0.5,0.3,1
    size_hint: 0.65, 0.3
    pos_hint: {"x":0.3, "top":0.375}

<CathodicAnodicToggle@BoxLayout>:
    pos_hint: {"x":0.075, "top":.6}
    size_hint: .85,.06
    ToggleButton:
        text: "Cathodic First"
        font_size: 14
        group: "cathodic_anodic"
    ToggleButton:
        text: "Anodic First"
        group: "cathodic_anodic"
        font_size: 14

<TerminationTabs>:
    tab_width: (self.parent.width*.85)/3
    pos_hint: {"x":0.075, "top":.45}
    size_hint: .85,.25
    do_default_tab: False
    TabbedPanelItem:
        text: "Time"
        font_size: 14
        group: "termination"
        FloatLayout:
            Label:
                pos_hint: {"x":0, "top":.99}
                size_hint: 1,.33
                text_size: self.size
                halign: 'left'
                valign: 'middle'
                text: "Number of Minutes"
            TextInput:
                pos_hint: {"x":0, "top":.66}
                size_hint: 1,.66
                text: "0"
    TabbedPanelItem:
        text: "Duty Cycle"
        group: "termination"
        font_size: 14
        FloatLayout:
            Label:
                pos_hint: {"x":0, "top":.99}
                size_hint: 1,.33
                text_size: self.size
                halign: 'left'
                valign: 'middle'
                text: "Number of Cycles"
            TextInput:
                pos_hint: {"x":0, "top":.66}
                size_hint: 1,.66
                text: "0"
    TabbedPanelItem:
        text: "Non-Stop"
        group: "termination"
        font_size: 14

<DeviceSettings@BoxLayout>:
    size_hint: 1,1
    pos_hint: {"x":0, "top":1}
    orientation: 'vertical'
    BoxLayout:
        orientation: 'horizontal'
        BoxLayout:
            orientation: 'vertical'
            FloatLayout:
                size_hint: 1,.15
                pos_hint: {"x":0, "top":1}
                ToggleButton:
                    size_hint: 0.3, .9
                    pos_hint: {"x":0.05, "top":.875}
                    text: "Channel 1"
                ToggleButton:
                    size_hint: 0.3, .9
                    pos_hint: {"x":0.4, "top":.875}
                    text: "Channel 2"
            PhaseTimeFrequencyTabs:
            BurstUniformStimulationTabs:
        FloatLayout:
            Button:
                size_hint: .25,.06
                pos_hint: {"x":0.075, "top":.99}
                text: "Stop"
            Button:
                size_hint: .25,.06
                pos_hint: {"x":0.375, "top":.99}
                text: "Save"
            Button:
                size_hint: .25,.06
                pos_hint: {"x":0.675, "top":.99}
                text: "Start"
            Label:
                size_hint: .4,.05
                pos_hint: {"x":0.075, "top":.9}
                text: "Output Current (A)"
            TextInput:
                size_hint: .4,.08
                pos_hint: {"x":0.075, "top":.85}
                text: "0"
            Label:
                size_hint: .4,.05
                pos_hint: {"x":0.075, "top":.5}
                text: "End Stimulation By:"
            TerminationTabs:
            CathodicAnodicToggle:
            ToggleButton:
                size_hint: .4,.06
                pos_hint: {"x":0.075, "top":0.7}
                text: "Ramp Up"
                group: "ramp_up"
            ToggleButton:
                size_hint: .4,.06
                pos_hint: {"x":0.525, "top":0.7}
                text: "Short Electrode"
                group: "electrode"
            Button:
                size_hint: .4,.1
                pos_hint: {"x":0.525, "top":0.15}
                text: "Generate Graph"
                group: "electrode"
    BoxLayout:
        size_hint: 1,.5
        pos_hint: {"x":0, "top":1}
        Button:
            text:"x"


<PhaseTimeFrequencyTabs>:
    tab_width: (self.parent.width*.995)/2
    size_hint: .995,1
    pos_hint: {"x":0, "top":1}
    do_default_tab: False
    color: .2,.2,.1,1
    background_color: 0.1,0.2,0.3,1
    TabbedPanelItem:
        text: "Phase Time"
        FloatLayout:
            Label:
                size_hint: .4,.25
                pos_hint: {"x":0.05, "top":1}
                text: "Inter-Phase Delay"
                text_size: self.size
                halign: 'left'
                valign: 'middle'
            TextInput:
                size_hint: .4,.25
                pos_hint: {"x":0.05, "top":0.75}
                text: ""
            Label:
                size_hint: .4,.25
                pos_hint: {"x":0.55, "top":1}
                text: "Phase Time"
                text_size: self.size
                halign: 'left'
                valign: 'middle'
            TextInput:
                size_hint: .4,.25
                pos_hint: {"x":0.55, "top":0.75}
                text: ""
    TabbedPanelItem:
        text: "Frequency"

<BurstUniformStimulationTabs>:
    tab_width: (self.parent.width*.995)/2
    size_hint: .995,1
    pos_hint: {"x":0, "top":1}
    do_default_tab: False
    color: .2,.2,.1,1
    background_color: 0.1,0.2,0.3,1
    TabbedPanelItem:
        text: "Burst Stimulation"
        FloatLayout:
            Label:
                size_hint: .4,.25
                pos_hint: {"x":0.05, "top":1}
                text: "Burst Duration"
                text_size: self.size
                halign: 'left'
                valign: 'middle'
            TextInput:
                size_hint: .4,.25
                pos_hint: {"x":0.05, "top":0.75}
                text: ""
            Label:
                size_hint: .4,.25
                pos_hint: {"x":0.55, "top":1}
                text: "Inter-Burst Delay"
                text_size: self.size
                halign: 'left'
                valign: 'middle'
            TextInput:
                size_hint: .4,.25
                pos_hint: {"x":0.55, "top":0.75}
                text: ""
    TabbedPanelItem:
        text: "Uniform Stimulation"

<DeviceTabs>:
    size_hint: .8,1
    pos_hint: {"x":.2, "top":1}
    do_default_tab: False
    tab_width: (self.parent.width*.8)/4
    TabbedPanelItem:
        text: "Stimulation Setting"
        DeviceSettings:
    TabbedPanelItem:
        text: "Stimulation Log"
    TabbedPanelItem:
        text: "EEG recording"
    TabbedPanelItem:
        text: "Advanced Settings"

<HomeScreen>:
    name: "home"
    device_rv: device_rv
    FloatLayout:
        canvas.before:
            Color:
                rgb: .6, .6, .6
            Rectangle:
                size: self.size
        HomeButton:
        NewDeviceButton:
        BeginnerTutorial:
        GetHelp:
        LatestUpdate:
        ReportBug:
        SettingsHome:
        RecycleView:
            id: device_rv
            size_hint: .2, 0.7
            pos_hint: {"x":0, "top":.85}
            background_color: 0.0,0.50,0,1
            viewclass: 'ConnectedDeviceSelectableLabel'
            SelectableRecycleBoxLayout:
                default_size_hint: 1, None
                size_hint_y: None
                height: self.minimum_height
                orientation: 'vertical'
                multiselect: False
                touch_multiselect: False

<DeviceScreen>:
    name: "device"
    device_rv: device_rv
    FloatLayout:
        HomeButton:
        NewDeviceButton:
        DeviceTabs:
        RecycleView:
            id: device_rv
            size_hint: .2, 0.7
            pos_hint: {"x":0, "top":.85}
            background_color: 0.0,0.50,0,1
            viewclass: 'ConnectedDeviceSelectableLabel'
            SelectableRecycleBoxLayout:
                default_size_hint: 1, None
                size_hint_y: None
                height: self.minimum_height
                orientation: 'vertical'
                multiselect: False
                touch_multiselect: False