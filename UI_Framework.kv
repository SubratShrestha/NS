ScreenManagement:
    NeuroStimMainWindow:
    NeuroStimBluetoothWindow:


<SelectableLabel>:
    # Draw a background to indicate selection
    canvas.before:
        Color:
            rgba: (.0, 0.9, .1, .3) if self.selected else (.5, .5, .5, 1)
        RoundedRectangle:
            pos: self.pos
            size: self.size

<BluetoothDiscoverRV>:
    viewclass: 'SelectableLabel'
    SelectableRecycleBoxLayout:
        canvas.before:
            Color:
                rgba: (170, 170, 170, 0)
            Rectangle:
                pos: self.pos
                size: self.size
        default_size: None, dp(56)
        default_size_hint: 1, None
        size_hint_y: None
        height: self.minimum_height
        orientation: 'vertical'
        multiselect: False
        touch_multiselect: False


<NeuroStimMainWindow>
    name:"main"
    ble_rv: ble_rv
    input_frequency: input_frequency
    input_amplitude: input_amplitude
    input_pulse_width: input_pulse_width
    input_interstim_delay: input_interstim_delay

    FloatLayout:
        canvas.before:
            Color:
                rgb: .6, .6, .6
            Rectangle:
                size: self.size
        GridLayout:
            cols: 4
            rows: 1
            width: root.width
            height: root.height
            orientation: 'vertical'
            GridLayout:
                cols: 1
                rows: 3
                width: root.width
                height: root.height
                orientation: 'vertical'
                Button:
                    text: "Discover Devices"
                    size_hint_y: None
                    height: root.height/10
                    on_release: root.BluetoothDiscoverLoop()
                    text_size: self.size
                    halign: 'center'
                    valign: 'center'
                    padding_y: 10
                    front_size: 50
                BluetoothDiscoverRV:
                    id: ble_rv
                    pos: 0,0
                    height: root.height*8/10
                    width: root.width
                Button:
                    size_hint_y: None
                    height: root.height/10
                    text_size: self.size
                    halign: 'center'
                    valign: 'center'
                    padding_y: 10
                    text: "Connect Stimulators via Bluetooth"
                    front_size: 50
                    on_release:
                        app.root.current = "bluetooth"
                        root.manager.transition.direction = "left"
            GridLayout:
                cols: 1
                rows: 2
                width: root.width
                height: root.height
                orientation: 'vertical'
                GridLayout:
                    cols: 3
                    rows: 4
                    width: root.width
                    height: root.height
                    orientation: 'vertical'
                    Label:
                        multiline: False
                        size_hint_y: None
                        height: root.height/10
                        text: "Amplitude"
                        text_size: self.size
                        halign: 'center'
                        valign: 'center'
                        padding_y: 10
                        front_size: 50
                    TextInput:
                        id: input_amplitude
                        multiline: False
                        size_hint_y: None
                        height: 50
                        width: root.width/10
                        hint_text: "0"
                        text_size: self.size
                        halign: 'center'
                        valign: 'center'
                        padding_y: 10
                        front_size: 50
                        input_filter: 'float'
                    Label:
                        multiline: False
                        size_hint_y: None
                        height: root.height/10
                        text: "uA"
                        text_size: self.size
                        halign: 'center'
                        valign: 'center'
                        padding_y: 10
                        front_size: 50
                    Label:
                        multiline: False
                        size_hint_y: None
                        height: root.height/10
                        text: "Pulse Width"
                        text_size: self.size
                        halign: 'center'
                        valign: 'center'
                        padding_y: 10
                        front_size: 50
                    TextInput:
                        id: input_pulse_width
                        multiline: False
                        size_hint_y: None
                        height: 50
                        width: root.width/10
                        hint_text: "0"
                        text_size: self.size
                        halign: 'center'
                        valign: 'center'
                        padding_y: 10
                        front_size: 50
                        input_filter: 'float'
                    Label:
                        multiline: False
                        size_hint_y: None
                        height: root.height/10
                        text: "usec"
                        text_size: self.size
                        halign: 'center'
                        valign: 'center'
                        padding_y: 10
                        front_size: 50
                    Label:
                        multiline: False
                        size_hint_y: None
                        height: root.height/10
                        text: "Interstim Delay"
                        text_size: self.size
                        halign: 'center'
                        valign: 'center'
                        padding_y: 10
                        front_size: 50
                    TextInput:
                        id: input_interstim_delay
                        multiline: False
                        size_hint_y: None
                        height: 50
                        width: root.width/10
                        hint_text: "0"
                        text_size: self.size
                        halign: 'center'
                        valign: 'center'
                        padding_y: 10
                        front_size: 50
                        input_filter: 'float'
                    Label:
                        multiline: False
                        size_hint_y: None
                        height: root.height/10
                        text: "usec"
                        text_size: self.size
                        halign: 'center'
                        valign: 'center'
                        padding_y: 10
                        front_size: 50
                    Label:
                        multiline: False
                        size_hint_y: None
                        height: root.height/10
                        text: "Frequency"
                        text_size: self.size
                        halign: 'center'
                        valign: 'center'
                        padding_y: 10
                        front_size: 50
                    TextInput:
                        id: input_frequency
                        multiline: False
                        size_hint_y: None
                        height: 50
                        width: root.width/10
                        hint_text: "0"
                        text_size: self.size
                        halign: 'center'
                        valign: 'center'
                        padding_y: 10
                        front_size: 50
                        input_filter: 'float'
                    Label:
                        multiline: False
                        size_hint_y: None
                        height: root.height/10
                        text: "Hz"
                        text_size: self.size
                        halign: 'center'
                        valign: 'center'
                        padding_y: 10
                        front_size: 50
                Button:
                    size_hint_y: None
                    height: root.height/10
                    text_size: self.size
                    halign: 'center'
                    valign: 'center'
                    padding_y: 10
                    text: "Send Data to Stimulators"
                    front_size: 50
                    on_release: root.save_input_data()
            GridLayout:
                cols: 1
                rows: 3
                width: root.width
                height: root.height
                orientation: 'vertical'

            GridLayout:
                cols: 1
                rows: 3
                width: root.width
                height: root.height
                orientation: 'vertical'


<NeuroStimBluetoothWindow>
    name:"bluetooth"
    GridLayout:
        cols: 1
        rows: 1
        width: root.width
        height: root.height
        ActionBar:
            pos_hint: {'top':1}
            ActionView:
                ActionPrevious:
                    with_previous: True
                    on_release:
                        app.root.current = "main"
                        root.manager.transition.direction = "right"
                ActionLabel:
                    text: "Battery:"
                    front_size: 50
                ActionLabel:
                    text: "99%"
                    front_size: 50
